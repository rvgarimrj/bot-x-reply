<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

---

# Bot-X-Reply

Sistema de engajamento automatizado no X (Twitter).

## üéØ META: 500 Premium Followers
- **Atual**: 28/500
- **F√≥rmula**: Author Reply (75x boost) ‚Üí Visibilidade ‚Üí Follow

---

## ‚ö†Ô∏è REGRAS CR√çTICAS

### Anti-Detec√ß√£o de IA (BLOQUEIO SE VIOLAR!)

**PROIBIDO:**
- "Fun fact:", "Interestingly,", "Actually,", "It's worth noting"
- "masterpiece", "revolutionary", "game-changer", "incredible"
- Gram√°tica 100% perfeita
- M√∫ltiplos fatos em um reply
- Sempre come√ßar com "wait" (padr√£o bot!)

**HUMANO:**
- "omg", "lol", "ngl", "tbh", "lowkey" (EN)
- "cara", "mano", "p√¥", "kkkk" (PT)
- UMA ideia por reply, <80 chars
- Opini√£o pessoal, informal

### Pol√≠tica Americana
- **Inclina√ß√£o**: Direita / Republicano
- **Tom**: Concord√¢ncia casual, n√£o agressivo
- **Estilo**: Como observa√ß√£o natural, n√£o panflet√°rio

**Exemplo:**
```
‚ùå "That's Eric Chahi's masterpiece! The rotoscoped animation was revolutionary."
‚úÖ "played this so much as a kid, the death animations were brutal"
```

### NUNCA come√ßar com:
- ngl, tbh, honestly, actually
- na verdade, sinceramente

### VARIAR abordagem:
- 40% perguntas
- 25% contrarian (opini√£o diferente)
- 20% rea√ß√£o curta
- 15% concord√¢ncia

---

## ü§ñ Sistemas Ativos

### 1. Auto-Daemon (50-80 replies/dia)
```bash
# Status
pgrep -f "auto-daemon" && echo "OK"

# Iniciar (com auto-restart em caso de crash)
nohup ./scripts/start-daemon.sh >> logs/auto-daemon.log 2>&1 &

# Parar (SIGINT = encerramento limpo, N√ÉO reinicia)
pkill -2 -f "auto-daemon.js"
```
**NUNCA usar `nohup node ...`** - usar sempre o wrapper `start-daemon.sh` que garante PATH e auto-restart.

### 2. Reply-to-Reply (responde quem interage)
```bash
# Status - roda via crontab a cada 15min (8h-23h)
tail -5 logs/reply-to-reply.log

# Manual
node scripts/reply-to-reply.js
node scripts/reply-to-reply.js --dry-run
```

**Regras R2R:**
- Max 2 replies por pessoa por thread
- Tom: gentil, humor√≠stico
- Sempre curte o reply antes
- Max 50 chars + 1-2 emojis

### 3. Chrome (debug mode)
```bash
# Verificar
curl -s http://127.0.0.1:9222/json/version | head -1

# Iniciar
"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" \
  --remote-debugging-port=9222 \
  --user-data-dir="$HOME/.chrome-bot-profile" \
  --disable-background-timer-throttling \
  --disable-backgrounding-occluded-windows \
  --disable-renderer-backgrounding \
  "https://x.com" &
```

---

## üìä Crontab

| Hor√°rio | Script | Fun√ß√£o |
|---------|--------|--------|
| :07/:22/:37/:52 8-23h | reply-to-reply.js | Responde intera√ß√µes |
| 14:07 | collect-metrics.js | Coleta likes |
| 22:07 | collect-metrics.js | Segunda coleta |
| 23:00 | analyze-and-learn.js | Gera insights |
| 23:30 | daily-optimizer.js | Ajustes autom√°ticos |
| 23:59 | nightly-analytics.js | M√©tricas X Analytics |
| 00:05 | daily-report.js | Relat√≥rio + Telegram |

**IMPORTANTE**: Evitar minuto :00 nos crontabs - outro rob√¥ posta nos hor√°rios cheios.
- Daemon: evita automaticamente minutos 57-02 (¬±3min do :00)
- R2R: roda nos :07/:22/:37/:52
- Crontabs: nunca usar minuto :00

---

## üîç Discovery (7 Fontes)

1. **Timeline** - Feed pessoal
2. **Trending** - T√≥picos em alta (filtrado por nicho)
3. **Hacker News** - Tweets sobre posts HN
4. **Creator Inspiration** - Curados pelo X
5. **Keyword Search** - Busca ativa por termos
6. **Monitored Accounts** - Mid-tier creators prioritizados (marc_loub, tdinh_me, dvassallo...)
7. **Hype Mode** - Alto engajamento (30% ciclos)

**Nicho**: Tech/AI/Crypto/Startups/Vibe Coding

**Estrat√©gia de Scoring (2026-02-06):**
- Sweet spot: +15 para tweets com 10-500 likes (contas m√©dias respondem mais)
- Penalidade: -15 para tweets com >5000 likes (mega-contas nunca respondem)
- Keywords para small creators: min_faves 5-20 (vs 50-500 anterior)
- Mega-contas (sama, paulg, karpathy) rebaixadas para priority "low"
- Mid-tier creators (1K-50K followers) como priority "high"

---

## üìà Algoritmo do X (Pesos)

| Engajamento | Peso |
|-------------|------|
| Like | 1x |
| Reply | 13.5x |
| **Author Reply** | **75x** |

**Foco**: Conseguir que autores respondam nossos replies!

---

## ‚è∞ Hor√°rios de Ouro

| Tier | Hor√°rios BR | Intervalo |
|------|-------------|-----------|
| ü•á GOLD | 12-14h, 20-21h | 8-12min |
| üî• HIGH | 11h, 15-17h, 19h, 22h | 10-15min |
| üìà MEDIUM | 10h, 18h, 23h | 12-18min |
| üìâ LOW | 8-9h | 18-25min |

---

## üîß Comandos √öteis

```bash
# Ver m√©tricas do dia
node -e "import('./src/finder.js').then(m => console.log(m.getDailyStats()))"

# Ver melhores fontes
node -e "import('./src/knowledge.js').then(m => console.log(m.getBestSources()))"

# Rodar an√°lise
node scripts/analyze-and-learn.js

# Ver estado R2R
cat data/reply-to-reply-state.json | head -20

# Ver conhecimento
cat data/knowledge.json | jq '.replies | length'
```

---

## üêõ Problemas Comuns

| Problema | Solu√ß√£o |
|----------|---------|
| Timeout Chrome | Verificar flags anti-suspens√£o |
| Crontab n√£o roda | Usar `/usr/local/bin/node` |
| R2R n√£o detecta | Verificar `/notifications` (n√£o `/mentions`) |
| M√∫ltiplos daemons | `pkill -9 -f auto-daemon` |
| Resumo errado | `getDailyStats()` l√™ de knowledge.json |
| "JavaScript world" error | Usar `page.evaluate()` (fix 2026-02-05) |
| "Frame detached" error | maxTabs=6, dialog handler, retry (fix 2026-02-05) |
| "Execution context destroyed" | Conflito daemon/R2R - maxTabs=6 resolve |
| Reply vai p/ tweet errado | Encontrar tweet focado, n√£o 1¬∫ da p√°gina |
| Verifica√ß√£o falso positivo | SEMPRE recarregar e buscar reply na thread |
| "Sair do site?" modal | Handler de dialog no Puppeteer (fix 2026-02-05) |
| R2R contagem errada | Contador por PESSOA, n√£o por tweet (fix 2026-02-05) |
| R2R loop em bloqueado | Marca como processado mesmo em falha (fix 2026-02-06) |
| Ano errado nos replies | `fixYear()` corrige 2023-2025‚Üí2026 antes de postar (fix 2026-02-06) |
| M√∫ltiplos daemons ap√≥s restart | Matar wrapper E node: `pkill -9 -f start-daemon; pkill -9 -f auto-daemon` |
| Reply postado na aba errada | Fecha todas abas antes de postar + verifica URL (fix 2026-02-06) |
| Reply em ingl√™s pra tweet PT | Prompt refor√ßado + valida√ß√£o p√≥s-gera√ß√£o `detectLanguage()` (fix 2026-02-06) |
| Conflito hor√°rio c/ rob√¥ posts | Daemon evita ¬±3min de todos :00, R2R nos :07/:22/:37/:52 (fix 2026-02-06) |

---

## üîß Corre√ß√µes R2R (2026-02-05)

### Problema 1: R2R falhava ao postar replies

**Erros encontrados:**
1. `Protocol error: Argument should belong to same JavaScript world`
2. `Navigating frame was detached`

**Solu√ß√µes em `src/puppeteer.js`:**

1. **humanType()** - Usa `page.evaluate()` para encontrar/clicar elementos
   - Evita element handles stale entre opera√ß√µes async
   - Usa `page.keyboard.type()` ap√≥s focar via evaluate

2. **closeExcessTabs()** - Recebe `currentPage` como par√¢metro
   - Nunca fecha a p√°gina que est√° sendo usada
   - Cleanup acontece DEPOIS de criar nova p√°gina

### Problema 2: Reply ia para tweet errado

**Causa:** Seletor `[data-testid="reply"]` pegava o 1¬∫ bot√£o (do tweet pai), n√£o do tweet alvo.

**Solu√ß√£o:** Nova l√≥gica para encontrar tweet correto:
1. Procura tweet com √°rea de reply inline (o focado)
2. Fallback: √∫ltimo tweet da thread
3. Clica no reply button DAQUELE tweet espec√≠fico

### Problema 3: Verifica√ß√£o falso positivo

**Causa:** "Modal fechou" era assumido como sucesso, mas modal pode fechar por erro.

**Solu√ß√£o:** Verifica√ß√£o OBRIGAT√ìRIA:
1. Recarrega p√°gina ap√≥s post
2. Busca nosso reply na thread
3. S√≥ retorna sucesso se encontrar

**Commits:**
- `e742dc9` - fix: Robust reply posting - context issues and verification
- `b4a701e` - fix: Target correct tweet for reply + mandatory verification

**Resultado:** @joelteply reply postado e verificado com sucesso

### Problema 4: Modal "Sair do site?" bloqueava navega√ß√£o

**Causa:** Chrome mostra dialog `beforeunload` quando h√° texto n√£o enviado no campo.

**Solu√ß√£o em `src/puppeteer.js`:**
- Adicionado handler `page.on('dialog')` que aceita automaticamente
- Permite reload/navega√ß√£o mesmo com drafts

### Problema 5: Contagem de replies por pessoa errada

**Causa:** Chave era `username_tweetId`, ent√£o mesma pessoa em tweets diferentes n√£o somava.

**Solu√ß√£o em `scripts/reply-to-reply.js`:**
- Chave agora √© apenas `person_username`
- Limita 2 replies por PESSOA total, n√£o por tweet

### Problema 6: Daemon fecha abas do R2R (e vice-versa)

**Causa:** Ambos compartilham o mesmo Chrome. `closeExcessTabs(browser, 3)` fechava abas de outro processo.

**Solu√ß√µes:**
1. `maxTabs` aumentado de 3 para 6 em todos os `closeExcessTabs`
2. `extractTweet` e `checkLogin`: criam p√°gina ANTES de fechar abas (protege a atual)
3. R2R: dialog handler em todas as p√°ginas (notifications + thread context)
4. R2R: try/catch no scroll loop (degrada graciosamente se frame detach)
5. R2R: retry (2 tentativas) no post de replies
6. Crontab: R2R nos minutos :07/:22/:37/:52 (evita conflito com posts agendados nos :00)

**Commit:** `7bc4927` - fix: R2R frame detached + daemon tab conflict

---

## üéØ Otimiza√ß√£o: Contas Menores + Perguntas (2026-02-06)

### Problema
- Author reply rate: 0% em 238 replies
- Mega-contas (sama 3M+, paulg 1.5M+) nunca respondem
- Apenas 3% de replies eram perguntas (meta: 40%)

### Mudan√ßas

1. **Scoring sweet spot** (`src/discovery.js`): +15 para 10-500 likes, -15 para >5000
2. **Keywords small creators** (`src/discovery.js`): 6 queries novas com min_faves 5-20
3. **Monitored accounts** (`src/discovery.js` + `config/accounts.json`): mega-contas‚Üílow, 10 mid-tier‚Üíhigh
4. **40% question bias** (`src/claude.js`): `getStyleHint()` seleciona pergunta 40% das vezes, dedup window 5‚Üí3
5. **Filtros** (`config/accounts.json`): min_likes 10‚Üí5, max_replies 200‚Üí100

**Commits:**
- `6c24960` - feat: Focus on smaller accounts + 40% question bias
- `b138ae4` - fix: R2R marks blocked/failed replies as processed

### Fix: Ano errado nos replies

**Causa:** Claude knowledge cutoff gera "2024"/"2025" em vez de 2026.

**Solu√ß√£o (3 camadas):**
1. Prompt inclui "Estamos em {ano atual}" (hint)
2. `fixYear()` em `src/claude.js` corrige 2023-2025‚Üíano atual nos replies do daemon
3. `fixYear()` em `scripts/reply-to-reply.js` corrige nos replies do R2R
4. Usa `new Date().getFullYear()` - n√£o precisa atualizar manualmente

**Commits:**
- `391a9ce` - fix: Add current year to Claude prompts
- `ec907c0` - fix: Auto-correct wrong years (fixYear filter)

### Fix: R2R loop em user bloqueado

**Causa:** `author_blocked` n√£o era marcado como processado ‚Üí re-tentava infinitamente.

**Solu√ß√£o:** Sempre adiciona `tweetId` a `repliedTo` ap√≥s tentativa, independente do resultado.

**Commit:** `b138ae4`

### Fix: M√∫ltiplos daemons

**Causa:** `pkill -9` mata o node mas wrapper `start-daemon.sh` reinicia. M√∫ltiplos wrappers acumulam.

**Solu√ß√£o correta para restart:**
```bash
# Matar TUDO (wrapper + node)
pkill -9 -f "start-daemon.sh"; pkill -9 -f "auto-daemon.js"
# Esperar
sleep 2
# Iniciar 1 s√≥
nohup ./scripts/start-daemon.sh >> logs/auto-daemon.log 2>&1 &
# Verificar
ps -ef | grep -i "auto-daemon\|start-daemon" | grep -v grep
```

---

## üìÅ Arquivos Importantes

| Arquivo | Conte√∫do |
|---------|----------|
| data/knowledge.json | Replies postados + m√©tricas |
| data/learnings.json | Insights aprendidos |
| data/reply-to-reply-state.json | Estado R2R |
| config/accounts.json | Configura√ß√µes discovery |
| logs/auto-daemon.log | Log do daemon |
| logs/reply-to-reply.log | Log R2R |

---

## üöÄ In√≠cio de Sess√£o

```bash
# 1. Verificar sistemas
pgrep -f "auto-daemon" && echo "Daemon OK"
curl -s http://127.0.0.1:9222/json/version | head -1

# 2. Ver insights recentes
cat data/learnings.json | head -30

# 3. Ver m√©tricas do dia
node -e "import('./src/finder.js').then(m => console.log(m.getDailyStats()))"
```
